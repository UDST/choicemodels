

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Multinomial Logit API &mdash; ChoiceModels 0.2.2 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Simulation utilities API" href="simulation-utilities.html" />
    <link rel="prev" title="Choice table utilities API" href="choice-table-utilities.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> ChoiceModels
          

          
          </a>

          
            
            
              <div class="version">
                0.2.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="choice-table-utilities.html">Choice table utilities API</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Multinomial Logit API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#multinomiallogit">MultinomialLogit</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multinomiallogitresults">MultinomialLogitResults</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="simulation-utilities.html">Simulation utilities API</a></li>
<li class="toctree-l1"><a class="reference internal" href="distance-utilities.html">Distance utilities API</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ChoiceModels</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Multinomial Logit API</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/multinomial-logit.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="multinomial-logit-api">
<h1>Multinomial Logit API<a class="headerlink" href="#multinomial-logit-api" title="Permalink to this headline">¶</a></h1>
<p>ChoiceModels has built-in functionality for Multinomial Logit estimation and simulation. This can use either the <a class="reference external" href="https://github.com/timothyb0912/pylogit">PyLogit</a> MNL estimation engine or a custom engine optimized for fast performance with large numbers of alternatives. The custom engine is originally from <code class="docutils literal notranslate"><span class="pre">urbansim.urbanchoice</span></code>.</p>
<p>Fitting a model yields a results object that can generate choice probabilities for out-of-sample scenarios.</p>
<div class="section" id="multinomiallogit">
<h2>MultinomialLogit<a class="headerlink" href="#multinomiallogit" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="choicemodels.MultinomialLogit">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">choicemodels.</span></code><code class="sig-name descname"><span class="pre">MultinomialLogit</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_expression</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">observation_id_col</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">choice_col</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_labels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alternative_id_col</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initial_coefs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/choicemodels/mnl.html#MultinomialLogit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#choicemodels.MultinomialLogit" title="Permalink to this definition">¶</a></dt>
<dd><p>A class with methods for estimating multinomial logit discrete choice models. Each
observation is a choice scenario in which a chooser selects one alternative from a
choice set of two or more. The fitted parameters represent a joint optimization of
utility expressions that explains observed choices based on attributes of the
alternatives and of the choosers.</p>
<p>The input data needs to be in “long” format, with one row for each combination of
chooser and alternative. Columns contain relevant attributes and identifiers. (If the
choice sets are large, sampling of alternatives should be carried out before data is
passed to this class.)</p>
<p>The class constructor supports two use cases:</p>
<ol class="arabic">
<li><p>The first use case is simpler and requires fewer inputs. Each choice scenario must
have the same number of alternatives, and each alternative must have the same model
expression (utility equation). This is typical when the alternatives are relatively
numerous and homogenous, for example with travel destination choice or household
location choice.</p>
<p>The following parameters are required: ‘data’, ‘observation_id_col’, ‘choice_col’,
‘model_expression’ in Patsy format. If data is provided as a MergedChoiceTable,
the observation id and choice column names can be read directly from its metadata.</p>
<p>To fit this type of model, ChoiceModels will use its own estimation engine adapted
from the UrbanSim MNL codebase.</p>
<p>Migration from ‘urbansim.urbanchoice’: Note that these requirements differ from
the old UrbanSim codebase in a couple of ways. (1) The chosen alternatives need to
be indicated in a column of the estimation data table instead of in a separate
matrix, and (2) in lieu of indicating the number of alternatives in each choice
set, the estimation data table should include an observation id column. These
changes make the API more consistent with other use cases. See the
MergedChoiceTable() class for tools and code examples to help with migration.</p>
</li>
<li><p>The second use case is more flexible. Choice scenarios can have varying numbers of
alternatives, and the model expression (utility equation) can be different for
distinct alternatives. This is typical when there is a small number of alternatives
whose salient characteristics vary, for example with travel mode choice.</p>
<p>The following parameters are required: ‘data’, ‘observation_id_col’,
‘alternative_id_col’, ‘choice_col’, ‘model_expression’ in PyLogit format,
‘model_labels’ in PyLogit format (optional).</p>
<p>To fit this type of model, ChoiceModels will use the PyLogit estimation engine.</p>
</li>
</ol>
<p>With either use case, the model expression can include attributes of both the choosers
and the alternatives. Attributes of a particular alternative may vary for different
choosers (distance, for example), but this must be set up manually in the input data.</p>
<p>Note that prediction methods are in a separate class: see MultinomialLogitResults().</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>pd.DataFrame</em><em> or </em><a class="reference internal" href="choice-table-utilities.html#choicemodels.tools.MergedChoiceTable" title="choicemodels.tools.MergedChoiceTable"><em>choicemodels.tools.MergedChoiceTable</em></a>) – A table of estimation data in “long” format, with one row for each combination of
chooser and alternative. Column labeling must be consistent with the
‘model_expression’. May include extra columns.</p></li>
<li><p><strong>model_expression</strong> (<em>Patsy 'formula-like'</em><em> or </em><em>PyLogit 'specification'</em>) – <p>For the simpler use case where each choice scenario has the same number of
alternatives and each alternative has the same model expression, this should be a
Patsy formula representing the right-hand side of the single model expression.
This can be a string or a number of other data types. See here:
<a class="reference external" href="https://patsy.readthedocs.io/en/v0.1.0/API-reference.html#patsy.dmatrix">https://patsy.readthedocs.io/en/v0.1.0/API-reference.html#patsy.dmatrix</a></p>
<p>For the more flexible use case where choice scenarios have varying numbers of
alternatives or the model expessions vary, this should be a PyLogit OrderedDict
model specification. See here:
<a class="reference external" href="https://github.com/timothyb0912/pylogit/blob/master/pylogit/pylogit.py#L116-L130">https://github.com/timothyb0912/pylogit/blob/master/pylogit/pylogit.py#L116-L130</a></p>
</p></li>
<li><p><strong>observation_id_col</strong> (<em>str</em><em>, </em><em>optional</em>) – Name of column or index containing the observation id. This should uniquely
identify each distinct choice scenario. Not required if data is passed as a
MergedChoiceTable.</p></li>
<li><p><strong>choice_col</strong> (<em>str</em><em>, </em><em>optional</em>) – Name of column containing an indication of which alternative has been chosen in
each scenario. Values should evaluate as binary: 1/0, True/False, etc. Not
required if data is passed as a MergedChoiceTable.</p></li>
<li><p><strong>model_labels</strong> (<em>PyLogit 'names'</em><em>, </em><em>optional</em>) – If the model expression is a PyLogit OrderedDict, you can provide a corresponding
OrderedDict of labels. See here:
<a class="reference external" href="https://github.com/timothyb0912/pylogit/blob/master/pylogit/pylogit.py#L151-L165">https://github.com/timothyb0912/pylogit/blob/master/pylogit/pylogit.py#L151-L165</a></p></li>
<li><p><strong>alternative_id_col</strong> (<em>str</em><em>, </em><em>optional</em>) – Name of column or index containing the alternative id. This is only required if
the model expression varies for different alternatives. Not required if data is
passed as a MergedChoiceTable.</p></li>
<li><p><strong>initial_coefs</strong> (<em>numeric</em><em> or </em><em>list-like of numerics</em><em>, </em><em>optional</em>) – Initial coefficients (beta values) to begin the optimization process with. Provide
a single value for all coefficients, or an array containing a value for each
one being estimated. If None, initial coefficients will be 0.</p></li>
<li><p><strong>weights</strong> (<em>1D array</em><em>, </em><em>optional</em>) – NOT YET IMPLEMENTED - Estimation weights.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt id="choicemodels.MultinomialLogit.estimation_engine">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">estimation_engine</span></code><a class="headerlink" href="#choicemodels.MultinomialLogit.estimation_engine" title="Permalink to this definition">¶</a></dt>
<dd><p>‘ChoiceModels’ or ‘PyLogit’.</p>
</dd></dl>

<dl class="py method">
<dt id="choicemodels.MultinomialLogit.fit">
<code class="sig-name descname"><span class="pre">fit</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/choicemodels/mnl.html#MultinomialLogit.fit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#choicemodels.MultinomialLogit.fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit the model using maximum likelihood estimation. Uses either the ChoiceModels
or PyLogit estimation engine as appropriate.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference internal" href="#choicemodels.MultinomialLogitResults" title="choicemodels.MultinomialLogitResults">MultinomialLogitResults</a>() object.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="multinomiallogitresults">
<h2>MultinomialLogitResults<a class="headerlink" href="#multinomiallogitresults" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="choicemodels.MultinomialLogitResults">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">choicemodels.</span></code><code class="sig-name descname"><span class="pre">MultinomialLogitResults</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_expression</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">results</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fitted_parameters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">estimation_engine</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ChoiceModels'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/choicemodels/mnl.html#MultinomialLogitResults"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#choicemodels.MultinomialLogitResults" title="Permalink to this definition">¶</a></dt>
<dd><p>The results class represents a fitted model. It can report the model fit, generate
choice probabilties, etc.</p>
<p>A full-featured results object is returned by MultinomialLogit.fit(). A results object
with more limited functionality can also be built directly from fitted parameters and
a model expression.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model_expression</strong> (<em>str</em><em> or </em><em>OrderedDict</em>) – Patsy ‘formula-like’ (str) or PyLogit ‘specification’ (OrderedDict).</p></li>
<li><p><strong>results</strong> (<em>dict</em><em> or </em><em>object</em><em>, </em><em>optional</em>) – Raw results as currently provided by the estimation engine. This should be
replaced with a more consistent and comprehensive set of inputs.</p></li>
<li><p><strong>fitted_parameters</strong> (<em>list of floats</em><em>, </em><em>optional</em>) – If not provided, these will be extracted from the raw results.</p></li>
<li><p><strong>estimation_engine</strong> (<em>str</em><em>, </em><em>optional</em>) – ‘ChoiceModels’ (default) or ‘PyLogit’.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt id="choicemodels.MultinomialLogitResults.get_raw_results">
<code class="sig-name descname"><span class="pre">get_raw_results</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/choicemodels/mnl.html#MultinomialLogitResults.get_raw_results"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#choicemodels.MultinomialLogitResults.get_raw_results" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the raw results as provided by the estimation engine. Dict or object.</p>
</dd></dl>

<dl class="py method">
<dt id="choicemodels.MultinomialLogitResults.probabilities">
<code class="sig-name descname"><span class="pre">probabilities</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/choicemodels/mnl.html#MultinomialLogitResults.probabilities"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#choicemodels.MultinomialLogitResults.probabilities" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate predicted probabilities for a table of choice scenarios, using the fitted
parameters stored in the results object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<a class="reference internal" href="choice-table-utilities.html#choicemodels.tools.MergedChoiceTable" title="choicemodels.tools.MergedChoiceTable"><em>choicemodels.tools.MergedChoiceTable</em></a>) – Long-format table of choice scenarios. TO DO - accept other data formats.</p></li>
<li><p><strong>class parameters</strong> (<em>Expected</em>) – </p></li>
<li><p><strong>-------------------------</strong> – </p></li>
<li><p><strong>self.model_expression</strong> (<em>patsy string</em>) – </p></li>
<li><p><strong>self.fitted_parameters</strong> (<em>list of floats</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pandas.Series with indexes matching the input</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="choicemodels.MultinomialLogitResults.report_fit">
<code class="sig-name descname"><span class="pre">report_fit</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/choicemodels/mnl.html#MultinomialLogitResults.report_fit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#choicemodels.MultinomialLogitResults.report_fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Print a report of the model estimation results.</p>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="simulation-utilities.html" class="btn btn-neutral float-right" title="Simulation utilities API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="choice-table-utilities.html" class="btn btn-neutral float-left" title="Choice table utilities API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Urban Data Science Toolkit.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>